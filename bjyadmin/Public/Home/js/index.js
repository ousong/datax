var map = L.map('mapId').setView([36.666806,75.896897], 4);
L.tileLayer('http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}',{

}).addTo(map);


var china = {
    "type": "Feature",
    "properties": {
        "popupContent": "中华人民共和国",
        "style": {
            weight:1,
            color: "#307373",
            opacity: 1,
            fillColor: "#307373",
            fillOpacity: 0.5
        }
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
            [
                [[110.339188,18.678395],[109.47521,18.197701],[108.655208,18.507682],[108.626217,19.367888],[109.119056,19.821039],[110.211599,20.101254],[110.786551,20.077534],[111.010051,19.69593],[110.570647,19.255879],[110.339188,18.678395]]
            ],

            [
                [[127.657407,49.76027],[129.397818,49.4406],[130.582293,48.729687],[130.987282,47.790132],[132.506672,47.78897],[133.373596,48.183442],[135.026311,48.47823],[134.500814,47.57844],[134.112362,47.212467],[133.769644,46.116927],[133.097127,45.144066],[131.883454,45.321162],[131.025212,44.967953],[131.288555,44.11152],[131.144688,42.92999],[130.633866,42.903015],[130.640016,42.395009],[129.994267,42.985387],[129.596669,42.424982],[128.052215,41.994285],[128.208433,41.466772],[127.343783,41.503152],[126.869083,41.816569],[126.182045,41.107336],[125.079942,40.569824],[124.265625,39.928493],[122.86757,39.637788],[122.131388,39.170452],[121.054554,38.897471],[121.585995,39.360854],[121.376757,39.750261],[122.168595,40.422443],[121.640359,40.94639],[120.768629,40.593388],[119.639602,39.898056],[119.023464,39.252333],[118.042749,39.204274],[117.532702,38.737636],[118.059699,38.061476],[118.87815,37.897325],[118.911636,37.448464],[119.702802,37.156389],[120.823457,37.870428],[121.711259,37.481123],[122.357937,37.454484],[122.519995,36.930614],[121.104164,36.651329],[120.637009,36.11144],[119.664562,35.609791],[119.151208,34.909859],[120.227525,34.360332],[120.620369,33.376723],[121.229014,32.460319],[121.908146,31.692174],[121.891919,30.949352],[121.264257,30.676267],[121.503519,30.142915],[122.092114,29.83252],[121.938428,29.018022],[121.684439,28.225513],[121.125661,28.135673],[120.395473,27.053207],[119.585497,25.740781],[118.656871,24.547391],[117.281606,23.624501],[115.890735,22.782873],[114.763827,22.668074],[114.42081,22.616665],[113.873491,22.479947],[113.625127,22.283177],[113.583733,22.120415],[113.273279,21.880209],[110.785466,21.397144],[110.444039,20.341033],[109.889861,20.282457],[109.627655,21.008227],[109.864488,21.395051],[108.522813,21.715212],[108.05018,21.55238],[107.04342,21.811899],[106.567273,22.218205],[106.725403,22.794268],[105.811247,22.976892],[105.329209,23.352063],[104.476858,22.81915],[103.504515,22.703757],[102.706992,22.708795],[102.170436,22.464753],[101.652018,22.318199],[101.80312,21.174367],[101.270026,21.201652],[101.180005,21.436573],[101.150033,21.849984],[100.416538,21.558839],[99.983489,21.742937],[99.240899,22.118314],[99.531992,22.949039],[98.898749,23.142722],[98.660262,24.063286],[97.60472,23.897405],[97.724609,25.083637],[98.671838,25.918703],[98.712094,26.743536],[98.68269,27.508812],[98.246231,27.747221],[97.911988,28.335945],[97.327114,28.261583],[96.248833,28.411031],[96.586591,28.83098],[96.117679,29.452802],[95.404802,29.031717],[94.56599,29.277438],[93.413348,28.640629],[92.503119,27.896876],[91.696657,27.771742],[91.258854,28.040614],[90.730514,28.064954],[90.015829,28.296439],[89.47581,28.042759],[88.814248,27.299316],[88.730326,28.086865],[88.120441,27.876542],[86.954517,27.974262],[85.82332,28.203576],[85.011638,28.642774],[84.23458,28.839894],[83.898993,29.320226],[83.337115,29.463732],[82.327513,30.115268],[81.525804,30.422717],[81.111256,30.183481],[79.721367,30.882715],[78.738894,31.515906],[78.458446,32.618164],[79.176129,32.48378],[79.208892,32.994395],[78.811086,33.506198],[78.912269,34.321936],[77.837451,35.49401],[76.192848,35.898403],[75.896897,36.666806],[75.158028,37.133031],[74.980002,37.41999],[74.829986,37.990007],[74.864816,38.378846],[74.257514,38.606507],[73.928852,38.505815],[73.675379,39.431237],[73.960013,39.660008],[73.822244,39.893973],[74.776862,40.366425],[75.467828,40.562072],[76.526368,40.427946],[76.904484,41.066486],[78.187197,41.185316],[78.543661,41.582243],[80.11943,42.123941],[80.25999,42.349999],[80.18015,42.920068],[80.866206,43.180362],[79.966106,44.917517],[81.947071,45.317027],[82.458926,45.53965],[83.180484,47.330031],[85.16429,47.000956],[85.720484,47.452969],[85.768233,48.455751],[86.598776,48.549182],[87.35997,49.214981],[87.751264,49.297198],[88.013832,48.599463],[88.854298,48.069082],[90.280826,47.693549],[90.970809,46.888146],[90.585768,45.719716],[90.94554,45.286073],[92.133891,45.115076],[93.480734,44.975472],[94.688929,44.352332],[95.306875,44.241331],[95.762455,43.319449],[96.349396,42.725635],[97.451757,42.74889],[99.515817,42.524691],[100.845866,42.663804],[101.83304,42.514873],[103.312278,41.907468],[104.522282,41.908347],[104.964994,41.59741],[106.129316,42.134328],[107.744773,42.481516],[109.243596,42.519446],[110.412103,42.871234],[111.129682,43.406834],[111.829588,43.743118],[111.667737,44.073176],[111.348377,44.457442],[111.873306,45.102079],[112.436062,45.011646],[113.463907,44.808893],[114.460332,45.339817],[115.985096,45.727235],[116.717868,46.388202],[117.421701,46.672733],[118.874326,46.805412],[119.66327,46.69268],[119.772824,47.048059],[118.866574,47.74706],[118.064143,48.06673],[117.295507,47.697709],[116.308953,47.85341],[115.742837,47.726545],[115.485282,48.135383],[116.191802,49.134598],[116.678801,49.888531],[117.879244,49.510983],[119.288461,50.142883],[119.279366,50.582908],[120.18205,51.643566],[120.738191,51.964115],[120.725789,52.516226],[120.177089,52.753886],[121.003085,53.251401],[122.245748,53.431726],[123.571507,53.458804],[125.068211,53.161045],[125.946349,52.792799],[126.564399,51.784255],[126.939157,51.353894],[127.287456,50.739797],[127.657407,49.76027]]
            ]
        ]
    }
};
var afuhan = {
    "type": "Feature",
    "properties": {
        "popupContent": "阿富汗",
        "style": {
            weight: 1,
            color: "#8dc76f",
            opacity: 1,
            fillColor: "#8dc76f",
            fillOpacity: 0.5
        }
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
            [
                [[61.210817,35.650072],[62.230651,35.270664],[62.984662,35.404041],[63.193538,35.857166],[63.982896,36.007957],[64.546479,36.312073],[64.746105,37.111818],[65.588948,37.305217],[65.745631,37.661164],[66.217385,37.39379],[66.518607,37.362784],[67.075782,37.356144],[67.83,37.144994],[68.135562,37.023115],[68.859446,37.344336],[69.196273,37.151144],[69.518785,37.608997],[70.116578,37.588223],[70.270574,37.735165],[70.376304,38.138396],[70.806821,38.486282],[71.348131,38.258905],[71.239404,37.953265],[71.541918,37.905774],[71.448693,37.065645],[71.844638,36.738171],[72.193041,36.948288],[72.63689,37.047558],[73.260056,37.495257],[73.948696,37.421566],[74.980002,37.41999],[75.158028,37.133031],[74.575893,37.020841],[74.067552,36.836176],[72.920025,36.720007],[71.846292,36.509942],[71.262348,36.074388],[71.498768,35.650563],[71.613076,35.153203],[71.115019,34.733126],[71.156773,34.348911],[70.881803,33.988856],[69.930543,34.02012],[70.323594,33.358533],[69.687147,33.105499],[69.262522,32.501944],[69.317764,31.901412],[68.926677,31.620189],[68.556932,31.71331],[67.792689,31.58293],[67.683394,31.303154],[66.938891,31.304911],[66.381458,30.738899],[66.346473,29.887943],[65.046862,29.472181],[64.350419,29.560031],[64.148002,29.340819],[63.550261,29.468331],[62.549857,29.318572],[60.874248,29.829239],[61.781222,30.73585],[61.699314,31.379506],[60.941945,31.548075],[60.863655,32.18292],[60.536078,32.981269],[60.9637,33.528832],[60.52843,33.676446],[60.803193,34.404102],[61.210817,35.650072]]
            ]
        ]
    }
};
var hongkong = {
    "type": "Feature",
    "properties": {
        "popupContent": "中国香港特别行政区",
        "style": {
            weight: 1,
            color: "#f5df40",
            opacity: 1,
            fillColor: "#f5df40",
            fillOpacity: 0.5
        }
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
            [
                [[113.882688,22.432918],[113.873491,22.313138],[113.822898,22.218951],[113.832097,22.193253],[113.94248,22.150412],[113.979275,22.16755],[114.213841,22.150412],[114.485201,22.163265],[114.503598,22.377319],[114.453005,22.484222],[114.457605,22.552596],[114.411612,22.569684],[114.241437,22.565412],[114.002272,22.505592]]
            ]
        ]
    }
};
var tuerqi = {
    "type": "Feature",
    "properties": {
        "popupContent": "土耳其",
        "style": {
            weight: 1,
            color: "#295767 ",
            opacity: 1,
            fillColor: "#295767 ",
            fillOpacity: 0.5
        }
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
            [
                [[36.913127,41.335358],[38.347665,40.948586],[39.512607,41.102763],[40.373433,41.013673],[41.554084,41.535656],[42.619549,41.583173],[43.582746,41.092143],[43.752658,40.740201],[43.656436,40.253564],[44.400009,40.005],[44.79399,39.713003],[44.109225,39.428136],[44.421403,38.281281],[44.225756,37.971584],[44.772699,37.170445],[44.293452,37.001514],[43.942259,37.256228],[42.779126,37.385264],[42.349591,37.229873],[41.212089,37.074352],[40.673259,37.091276],[39.52258,36.716054],[38.699891,36.712927],[38.167727,36.90121],[37.066761,36.623036],[36.739494,36.81752],[36.685389,36.259699],[36.41755,36.040617],[36.149763,35.821535],[35.782085,36.274995],[36.160822,36.650606],[35.550936,36.565443],[34.714553,36.795532],[34.026895,36.21996],[32.509158,36.107564],[31.699595,36.644275],[30.621625,36.677865],[30.391096,36.262981],[29.699976,36.144357],[28.732903,36.676831],[27.641187,36.658822],[27.048768,37.653361],[26.318218,38.208133],[26.8047,38.98576],[26.170785,39.463612],[27.28002,40.420014],[28.819978,40.460011],[29.240004,41.219991],[31.145934,41.087622],[32.347979,41.736264],[33.513283,42.01896],[35.167704,42.040225],[36.913127,41.335358]]],[[[27.192377,40.690566],[26.358009,40.151994],[26.043351,40.617754],[26.056942,40.824123],[26.294602,40.936261],[26.604196,41.562115],[26.117042,41.826905],[27.135739,42.141485],[27.99672,42.007359],[28.115525,41.622886],[28.988443,41.299934],[28.806438,41.054962],[27.619017,40.999823],[27.192377,40.690566]]
            ]
        ]
    }
};
var bajisitan = {
    "type": "Feature",
    "properties": {
        "popupContent": "巴基斯坦",
        "style": {
            weight: 1,
            color: "#49b48f",
            opacity: 1,
            fillColor: "#49b48f",
            fillOpacity: 0.5
        }
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
            [
                [[75.158028,37.133031],[75.896897,36.666806],[76.192848,35.898403],[77.837451,35.49401],[76.871722,34.653544],[75.757061,34.504923],[74.240203,34.748887],[73.749948,34.317699],[74.104294,33.441473],[74.451559,32.7649],[75.258642,32.271105],[74.405929,31.692639],[74.42138,30.979815],[73.450638,29.976413],[72.823752,28.961592],[71.777666,27.91318],[70.616496,27.989196],[69.514393,26.940966],[70.168927,26.491872],[70.282873,25.722229],[70.844699,25.215102],[71.04324,24.356524],[68.842599,24.359134],[68.176645,23.691965],[67.443667,23.944844],[67.145442,24.663611],[66.372828,25.425141],[64.530408,25.237039],[62.905701,25.218409],[61.497363,25.078237],[61.874187,26.239975],[63.316632,26.756532],[63.233898,27.217047],[62.755426,27.378923],[62.72783,28.259645],[61.771868,28.699334],[61.369309,29.303276],[60.874248,29.829239],[62.549857,29.318572],[63.550261,29.468331],[64.148002,29.340819],[64.350419,29.560031],[65.046862,29.472181],[66.346473,29.887943],[66.381458,30.738899],[66.938891,31.304911],[67.683394,31.303154],[67.792689,31.58293],[68.556932,31.71331],[68.926677,31.620189],[69.317764,31.901412],[69.262522,32.501944],[69.687147,33.105499],[70.323594,33.358533],[69.930543,34.02012],[70.881803,33.988856],[71.156773,34.348911],[71.115019,34.733126],[71.613076,35.153203],[71.498768,35.650563],[71.262348,36.074388],[71.846292,36.509942],[72.920025,36.720007],[74.067552,36.836176],[74.575893,37.020841],[75.158028,37.133031]]
            ]
        ]
    }
};

function onEachFeature(feature, layer) {
    var popupContent = "<p>这片土地属于：</p>";
    if (feature.properties && feature.properties.name) {
        popupContent += feature.properties.name;
    }
    layer.bindPopup(popupContent);
};
var CHN = L.geoJSON(china, {
    style: function (feature) {
        return feature.properties && feature.properties.style;
    },

    onEachFeature: onEachFeature,

}).addTo(map);
var AFG = L.geoJSON(afuhan, {
    style: function (feature) {
        return feature.properties && feature.properties.style;
    },

    onEachFeature: onEachFeature,

}).addTo(map);
var HongKong = L.geoJSON(hongkong, {
    style: function (feature) {
        return feature.properties && feature.properties.style;
    },

    onEachFeature: onEachFeature,

}).addTo(map);
var TUR = L.geoJSON(tuerqi, {
    style: function (feature) {
        return feature.properties && feature.properties.style;
    },

    onEachFeature: onEachFeature,

}).addTo(map);
var PAK = L.geoJSON(bajisitan, {
    style: function (feature) {
        return feature.properties && feature.properties.style;
    },

    onEachFeature: onEachFeature,

}).addTo(map);


function GetCountryData(obj){
    $.ajax({
            url: "../Api/GetCountryDataFromContinent",
            type: 'POST',
            dataType: 'json',
            data:{continent:obj},
            success: function(data){
                var data=$.parseJSON(data);

                if(data.list!=''&&data.list!=null){
                    var html='';
                    $.each(data.list,function(key,v){
                        html+='<div class="maskli_listli clearfix">';
                        html+='<div class="continentPart">'+v.continent_full+'(<span>'+v.count+'</span>)</div>';
                        html+='<div class="continentState clearfix">';
                        html+='<div class="partition">|</div>';
                        html+='<div class="countries">';
                        $.each(v.data,function(k,va){
                            html+="<span class='country' jsondata="+va.jsondata+" onclick=\"changshang("+va.lng+","+va.lat+","+va.jsondata+")\">"+va.name_chs+'</span>';
                        })
                        html+='</div>';
                        html+='</div>';
                        html+='</div>';
                    });
                    // alert(html);
                    $("#diqu").html(html);
                    $("#Continent1").html(data.Continent);
                    $(".maskli").css("display","block");

                }else{
                    $("#diqu").html("");
                    $("#Continent1").html(data.Continent);
                    $(".maskli").css("display","block");
                }

            }
    });
}
//左侧菜单栏交互
$(function(){
  var flage=true;
  $("#index_nav>li").on("click",function(){
    var index=$(this).index();
    $(this).addClass("active");
    $(this).siblings().removeClass("active");
    $(this).find(".line").addClass("active1");
    $(this).siblings().find(".line").removeClass("active1");
    if(index!=1){
      $(".sevenContinents").slideUp(500);
      $(".sevenContinents li").removeClass("active2");
    }
  });
  $(".index_nav_list").eq(0).on("click",function(){
    $(this).parent().addClass("active");
    $(this).parent().siblings().removeClass("active");
    $(this).next(".line").addClass("active1");
    $(this).parent().siblings().find(".line").removeClass("active1");
    if(flage){
      flage=!flage;
      $(".sevenContinents").slideDown(500);
    }else {
      flage=!flage;
      $(".sevenContinents").slideUp(500);
      $(".sevenContinents li").removeClass("active2");
      $(".mask").css("display","none");
    }
  })
  $(".sevenContinents li").on("click",function(){
    $(this).addClass("active2");
    $(this).siblings().removeClass("active2");
    $(".mask").css("display","block");
    $(".maskli").css("display","none");
    $(".maskli").eq(0).css("display","block");
    $(".maskli").eq(0).addClass("anima");
  })
})

var aa={};
var bb = null;
function changshang(lat,lng,jsondata){
  // alert(lng);
  // alert(lat);

    var geoJson = jsondata;
    console.log(geoJson)

    document.getElementById("mask").style.display="none";

    var latlng = L.latLng(lng,lat);
    map.panTo(latlng,{
        animate:true,
        duration:1
    })

    fang1()

    function fang1(){
        var num = 0;
        var ning = true;
        var de = true;
        setTimeout(function(){
            var time = setInterval(function(){
                if(de == true){
                    num+=0.05
                }else{
                    num=0
                }
                if(num == 0.7){
                    de = false;
                }

                if(ning == false){
                    map.removeLayer(bb)
                }

                aa = {
                    "type": "Feature",
                    "properties": {
                        "popupContent": "",
                        "style": {
                            weight: 1,
                            color: "#4c607e",
                            opacity: num,
                            fillColor: "#4c607e",
                            fillOpacity: num
                        }
                    },
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates":geoJson,
                    }
                };
                bb = L.geoJSON(aa, {
                    style: function (feature) {
                        return feature.properties && feature.properties.style;
                    },

                }).addTo(map);
                ning = false;

                //setTimeout(function(){
                //    map.removeLayer(bb)
                //},300)
            },50)
            setTimeout(function(){
                map.removeLayer(bb)
                clearInterval(time)
            },2000)
        },1000)
    }






}
